<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Learn&Earn</title>
<style>
  :root{
    --bg:#efe8ff;
    --ink:#231a44;
    --grad-a:#7b8cff;
    --grad-b:#c48aff;
    --ring:#cbb3ff;
    --lavender: #e6d1ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    color:var(--ink);
    background:var(--bg);
    overflow-x:hidden;
    position:relative;
  }
  .lavender-flowers {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    opacity: 0.15;
  }
  .flower {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--lavender) 0%, transparent 70%);
    box-shadow: 0 0 20px var(--lavender), 0 0 40px var(--grad-b);
  }
  .flower::before,
  .flower::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    background: radial-gradient(circle, var(--lavender) 0%, transparent 70%);
    border-radius: 50%;
  }
  .flower::before { top: -10px; left: 5px; }
  .flower::after { top: 5px; right: -10px; }
  .flower:nth-child(1) { top: 10%; right: 5%; width: 60px; height: 60px; }
  .flower:nth-child(2) { top: 25%; right: 15%; width: 45px; height: 45px; }
  .flower:nth-child(3) { top: 40%; right: 8%; width: 55px; height: 55px; }
  .flower:nth-child(4) { top: 60%; right: 20%; width: 40px; height: 40px; }
  .flower:nth-child(5) { top: 75%; right: 12%; width: 50px; height: 50px; }
  .flower:nth-child(6) { top: 15%; left: 5%; width: 45px; height: 45px; }
  .flower:nth-child(7) { top: 35%; left: 15%; width: 55px; height: 55px; }
  .flower:nth-child(8) { top: 55%; left: 8%; width: 40px; height: 40px; }
  .flower:nth-child(9) { top: 80%; left: 20%; width: 50px; height: 50px; }
  .bg{
    position:fixed; inset:-10% -10% -10% -10%;
    z-index:-2; pointer-events:none; overflow:hidden;
    filter:saturate(110%);
  }
  .bubble{
    position:absolute; border-radius:50%;
    background: radial-gradient(140% 140% at 30% 30%, #ffffff40 0%, #ffffff00 45%),
                linear-gradient(135deg,var(--grad-a),var(--grad-b));
    opacity:.22; filter:blur(6px);
    animation: drift linear infinite;
  }
  .bxs{width:120px;height:120px}
  .bsm{width:180px;height:180px}
  .bmd{width:260px;height:260px}
  .blg{width:380px;height:380px}
  .bxl{width:520px;height:520px}
  @keyframes drift{
    0%   { transform:translate3d(var(--x0),var(--y0),0) scale(1) }
    50%  { transform:translate3d(var(--x50),var(--y50),0) scale(1.03) }
    100% { transform:translate3d(var(--x100),var(--y100),0) scale(1) }
  }
  .b1{ --x0:-10vw; --y0:5vh; --x50:10vw; --y50:-2vh; --x100:30vw; --y100:10vh; animation-duration:23s}
  .b2{ --x0:70vw; --y0:-8vh; --x50:55vw; --y50:8vh; --x100:40vw; --y100:0vh; animation-duration:28s}
  .b3{ --x0:10vw; --y0:60vh; --x50:25vw; --y50:50vh; --x100:45vw; --y100:55vh; animation-duration:32s}
  .b4{ --x0:85vw; --y0:65vh; --x50:70vw; --y50:50vh; --x100:55vw; --y100:62vh; animation-duration:30s}
  .b5{ --x0:-6vw; --y0:85vh; --x50:10vw; --y50:70vh; --x100:26vw; --y100:80vh; animation-duration:26s}
  .b6{ --x0:50vw; --y0:-14vh; --x50:60vw; --y50:-2vh; --x100:72vw; --y100:8vh; animation-duration:34s}
  .b7{ --x0:82vw; --y0:20vh; --x50:88vw; --y50:40vh; --x100:92vw; --y100:18vh; animation-duration:29s}
  .b8{ --x0:35vw; --y0:90vh; --x50:30vw; --y50:70vh; --x100:25vw; --y100:88vh; animation-duration:36s}
  .wrap{max-width:1100px;margin-inline:auto;padding:24px}
  .row{display:flex;gap:16px;flex-wrap:wrap}
  .col{flex:1 1 320px}
  .muted{color:#6b5aa5}
  .right{margin-left:auto}
  .center{text-align:center}
  .divider{height:1px;background:#e6dcff;margin:16px 0}
  .btn{
    appearance:none;border:0;border-radius:14px;padding:12px 18px;
    background:linear-gradient(135deg,var(--grad-a),var(--grad-b));
    color:#fff;font-weight:800;letter-spacing:.2px;cursor:pointer;
    box-shadow:0 8px 22px #8b5cf64a, inset 0 -2px 0 #00000018;
    transform:translateZ(0); transition:transform .12s ease, box-shadow .2s ease, filter .2s ease;
  }
  .btn:hover{transform:translateY(-2px) scale(1.01); filter:saturate(1.05)}
  .btn:active{transform:translateY(0)}
  .btn.soft{background:#fff;color:var(--ink);border:2px solid #eadfff}
  .btn.ghost{background:transparent;border:2px solid #d8c3ff;color:var(--ink)}
  .iconBtn{
    border:0;background:#fff;border:2px solid #e7dcff;border-radius:12px;padding:8px;cursor:pointer;
    transition:transform .12s ease, box-shadow .2s ease;
  }
  .iconBtn:hover{transform:translateY(-1px); box-shadow:0 8px 20px #7c3aed20}
  .badge{background:#efe8ff;border:1px solid #e0d2ff;padding:4px 8px;border-radius:999px;font-weight:700}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:.35rem .7rem;border-radius:999px;background:#f2ecff;color:#3b2a6d;font-weight:700}
  .card{
    background:linear-gradient(#ffffffcc,#ffffffcc),
               radial-gradient(600px 400px at 80% -20%, #b49bff22 0, transparent 60%),
               radial-gradient(700px 500px at -20% 120%, #b49bff22 0, transparent 60%);
    backdrop-filter:saturate(120%) blur(2px);
    border:1px solid #e9ddff; border-radius:20px; padding:18px;
    box-shadow:0 24px 60px #7c3aed14;
    animation:pop .5s cubic-bezier(.2,.8,.2,1);
  }
  @keyframes pop{from{transform:scale(.97);opacity:0} to{transform:scale(1);opacity:1}}
  .input, select, textarea{
    width:100%;padding:12px 14px;border-radius:12px;border:2px solid #e5dbff;background:#fff;
    outline:none; font:inherit; color:var(--ink); transition:border .15s ease, box-shadow .15s ease, transform .08s ease;
  }
  .input:focus, select:focus, textarea:focus{border-color:var(--ring); box-shadow:0 0 0 4px #cbb3ff33}
  textarea{min-height:110px;resize:vertical}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px 12px;border-bottom:1px dashed #e8dcff;text-align:left}
  tr:hover td{background:#fbf9ff}
  nav{
    position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#efe8fff2,#efe8ffea 60%, transparent);
    border-bottom:1px solid #e6dcff; backdrop-filter: blur(6px);
  }
  nav .navwrap{display:flex;align-items:center;gap:14px;padding:10px 24px;max-width:1100px;margin:auto}
  .logo{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.2px}
  .logo svg{width:34px;height:34px}
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .avatar{
    width:34px;height:34px;border-radius:50%;display:grid;place-items:center;font-weight:900;color:#fff;
    background:linear-gradient(135deg,var(--grad-a),var(--grad-b)); box-shadow:0 8px 18px #8b5cf633;
    border:2px solid #ffffffcc; outline:2px solid #e6dcff;
  }
  .notification-bell {
    position: relative;
    cursor: pointer;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    border: 2px solid #e7dcff;
    border-radius: 12px;
    transition: transform .12s ease, box-shadow .2s ease;
  }
  .notification-bell:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 20px #7c3aed20;
  }
  .notification-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    width: 16px;
    height: 16px;
    background: #ff4757;
    color: white;
    border-radius: 50%;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
  }
  .notifications-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    width: 360px;
    max-height: 400px;
    overflow-y: auto;
    z-index: 20;
    display: none;
    border: 2px solid #e7dcff;
    backdrop-filter: blur(10px);
  }
  .notifications-dropdown.show {
    display: block;
  }
  .notification-item {
    padding: 14px 20px;
    border-bottom: 1px solid #f0e9ff;
    cursor: pointer;
    transition: background .2s ease;
  }
  .notification-item:hover {
    background: #f8f5ff;
  }
  .notification-item.unread {
    background: #f0e9ff;
    font-weight: 600;
  }
  .notification-item:last-child {
    border-bottom: none;
  }
  .notification-time {
    font-size: 12px;
    color: #888;
    margin-top: 4px;
  }
  .notification-header {
    padding: 16px 20px;
    font-weight: 800;
    border-bottom: 1px solid #e6dcff;
    background: linear-gradient(to right, var(--grad-a), var(--grad-b));
    color: white;
    border-radius: 16px 16px 0 0;
  }
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{padding:10px 14px;border-radius:12px;cursor:pointer;border:2px solid #decdff;background:#fff;color:var(--ink);font-weight:800;transition:transform .12s ease}
  .tab:hover{transform:translateY(-1px)}
  .tab.active{background:linear-gradient(135deg,var(--grad-a),var(--grad-b));color:#fff;border-color:transparent;box-shadow:0 10px 22px #8b5cf633}
  .view{opacity:0; transform:translateY(10px); transition:opacity .38s ease, transform .38s ease}
  .view.show{opacity:1; transform:translateY(0)}
  .hide{display:none !important}
  .status{font-weight:800}
  .status.open{color:#2563eb}
  .status.progress{color:#f59e0b}
  .status.done{color:#059669}
  .chat{
    display:flex;flex-direction:column;gap:10px;height:280px;overflow:auto;background:#fff;border:2px solid #e6dcff;border-radius:16px;padding:12px
  }
  .msg{max-width:75%;padding:10px 13px;border-radius:14px; animation:msgUp .25s ease}
  .me{background:#ede7ff;margin-left:auto}
  .them{background:#f7f4ff}
  @keyframes msgUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  .modal{position:fixed;inset:0;display:grid;place-items:center;background:#1a103080;opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:20}
  .modal.show{opacity:1;pointer-events:auto}
  .sheet{width:min(560px,92vw)}
  footer{padding:40px 0 80px;color:#6b5aa5}
  .icon{width:22px;height:22px;display:inline-block;vertical-align:-4px}
  .icon24{width:24px;height:24px}
  .icon32{width:32px;height:32px}
</style>
</head>
<body>
<!-- LAVENDER FLOWERS -->
<div class="lavender-flowers" aria-hidden="true">
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
  <div class="flower"></div>
</div>
<!-- BUBBLE BACKGROUND -->
<div class="bg" aria-hidden="true">
  <span class="bubble blg b1"></span>
  <span class="bubble bmd b2"></span>
  <span class="bubble bsm b3"></span>
  <span class="bubble blg b4"></span>
  <span class="bubble bmd b5"></span>
  <span class="bubble bxs b6"></span>
  <span class="bubble bsm b7"></span>
  <span class="bubble bxl b8"></span>
</div>
<!-- NAV -->
<nav>
  <div class="navwrap">
    <div class="logo">
      <svg viewBox="0 0 64 64" class="icon32" aria-hidden="true">
        <defs><linearGradient id="gLogo" x1="0" x2="1" y1="1" y2="0"><stop offset="0%" stop-color="var(--grad-a)"/><stop offset="100%" stop-color="var(--grad-b)"/></linearGradient></defs>
        <path fill="url(#gLogo)" d="M10 18a8 8 0 0 1 8-8h12a6 6 0 0 1 0 12H26v12a8 8 0 0 1-16 0V18z"/>
        <path fill="url(#gLogo)" d="M46 12a4 4 0 0 1 4 4v8h6a4 4 0 1 1 0 8h-6v8a4 4 0 1 1-8 0v-8h-6a4 4 0 1 1 0-8h6v-8a4 4 0 0 1 4-4z"/>
      </svg>
      <span>Learn&Earn</span>
    </div>
    <div class="right toolbar" id="authBtns">
      <div class="notification-bell" id="notificationBell">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        <div class="notification-badge" id="notificationCount" style="display:none;">0</div>
      </div>
      <button class="btn ghost" id="loginOpen">Login</button>
      <button class="btn" id="signupOpen">Sign Up</button>
    </div>
    <div class="right toolbar hide" id="userMenu">
      <div class="notification-bell" id="notificationBellAuth">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        <div class="notification-badge" id="notificationCountAuth" style="display:none;">0</div>
      </div>
      <div id="roleBadge" class="badge">Role</div>
      <button class="btn soft" id="goDash">Dashboard</button>
      <div id="avatar" class="avatar">U</div>
      <button class="btn ghost" id="logout">Logout</button>
    </div>
    <div class="notifications-dropdown" id="notificationsDropdown">
      <div class="notification-header">Notifications</div>
      <div id="notificationsList">No notifications</div>
    </div>
  </div>
</nav>
<!-- HOME -->
<section id="home" class="wrap view show">
  <div class="row">
    <div class="col">
      <h1 style="font-size:40px;line-height:1.1;margin-top:10px">Where learning meets opportunity.</h1>
      <p class="muted" style="font-size:18px">
        A simple marketplace where <b>companies</b> post small projects and <b>students</b> complete them to learn, build experience, and earn.
      </p>
      <div class="toolbar" style="margin-top:14px">
        <button class="btn" id="getStarted">Get Started</button>
      </div>
    </div>
    <div class="col card">
      <h3>Live counters</h3>
      <div class="row" style="margin-top:10px">
        <div class="col card"><div class="muted">Open Projects</div><div id="kOpen" style="font-size:28px;font-weight:900">0</div></div>
        <div class="col card"><div class="muted">Students</div><div id="kStudents" style="font-size:28px;font-weight:900">0</div></div>
        <div class="col card"><div class="muted">Companies</div><div id="kCompanies" style="font-size:28px;font-weight:900">0</div></div>
      </div>
    </div>
  </div>
</section>
<!-- ROLE SELECT -->
<section id="role" class="wrap view hide">
  <div class="row">
    <div class="col card">
      <div class="pill"><svg class="icon"><use href="#ico-briefcase"></use></svg> Company</div>
      <h2 style="margin-top:8px">I‚Äôm a Company</h2>
      <p class="muted">Hire talented students for quick, creative, affordable projects.</p>
      <button class="btn" id="chooseCompany"><svg class="icon" style="margin-right:6px"><use href="#ico-doc-plus"></use></svg> Continue as Company</button>
    </div>
    <div class="col card">
      <div class="pill"><svg class="icon"><use href="#ico-cap"></use></svg> Student</div>
      <h2 style="margin-top:8px">I‚Äôm a Student</h2>
      <p class="muted">Work with real companies, gain experience, build your portfolio and earn.</p>
      <button class="btn" id="chooseStudent"><svg class="icon" style="margin-right:6px"><use href="#ico-search-doc"></use></svg> Continue as Student</button>
    </div>
  </div>
</section>
<!-- COMPANY -->
<section id="company" class="wrap view hide">
  <div class="toolbar" style="margin-bottom:14px">
    <span class="badge">Company Dashboard</span>
    <div class="right tabs">
      <button class="tab active" data-ctab="c-post"><svg class="icon"><use href="#ico-doc-plus"></use></svg> Publish</button>
      <button class="tab" data-ctab="c-projects"><svg class="icon"><use href="#ico-folder"></use></svg> My Projects</button>
      <button class="tab" data-ctab="c-chat"><svg class="icon"><use href="#ico-msg-arrow"></use></svg> Chat</button>
      <button class="tab" data-ctab="c-leader"><svg class="icon"><use href="#ico-leader"></use></svg> Leaderboard</button>
    </div>
  </div>
  <div id="c-post" class="card">
    <h2><svg class="icon"><use href="#ico-doc-plus"></use></svg> Publish a Project</h2>
    <div class="row" style="margin-top:10px">
      <div class="col"><label>Title</label><input id="pTitle" class="input" placeholder="e.g., Design a poster"/></div>
      <div class="col"><label>Budget (‚Çπ)</label><input id="pBudget" type="number" class="input" placeholder="500"/></div>
      <div class="col"><label>Deadline</label><input id="pDue" type="date" class="input"/></div>
      <div class="col"><label>Category</label>
        <select id="pCat" class="input">
          <option>Design</option><option>Content</option><option>Research</option><option>Data Entry</option><option>Web</option>
        </select>
      </div>
    </div>
    <div style="margin-top:10px">
      <label>Description</label>
      <textarea id="pDesc" class="input" placeholder="What do you need?"></textarea>
    </div>
    <div class="toolbar" style="margin-top:10px">
      <span class="muted">Submit files via MEGA link</span>
      <button class="btn right" id="publishBtn"><svg class="icon" style="margin-right:6px"><use href="#ico-submit"></use></svg> Publish</button>
    </div>
  </div>
  <div id="c-projects" class="card hide">
    <h2><svg class="icon"><use href="#ico-folder"></use></svg> My Projects</h2>
    <div class="toolbar" style="margin:10px 0">
      <input class="input" id="cSearch" placeholder="Search my projects‚Ä¶">
    </div>
    <div class="divider"></div>
    <table id="cTable"><thead>
      <tr><th>Title</th><th>Category</th><th>Budget</th><th>Deadline</th><th>Status</th><th>Applicants</th><th>Actions</th></tr>
    </thead><tbody></tbody></table>
  </div>
  <div id="c-chat" class="card hide">
    <h2><svg class="icon"><use href="#ico-msg-arrow"></use></svg> Chat</h2>
    <div class="chat" id="cChat"></div>
    <div class="toolbar" style="margin-top:10px">
      <input id="cMsg" class="input" placeholder="Type a message‚Ä¶"/>
      <button class="btn" id="cSend">Send</button>
    </div>
  </div>
  <div id="c-leader" class="card hide">
    <h2><svg class="icon"><use href="#ico-leader"></use></svg> Leaderboard</h2>
    <table id="cLeader"><thead><tr><th>#</th><th>Student</th><th>XP</th><th>Done</th></tr></thead><tbody></tbody></table>
  </div>
</section>
<!-- STUDENT -->
<section id="student" class="wrap view hide">
  <div class="toolbar" style="margin-bottom:14px">
    <span class="badge">Student Dashboard</span>
    <div class="right tabs">
      <button class="tab active" data-stab="s-browse"><svg class="icon"><use href="#ico-search-doc"></use></svg> Find Projects</button>
      <button class="tab" data-stab="s-my"><svg class="icon"><use href="#ico-folder"></use></svg> My Applications</button>
      <button class="tab" data-stab="s-chat"><svg class="icon"><use href="#ico-msg-arrow"></use></svg> Chat</button>
      <button class="tab" data-stab="s-leader"><svg class="icon"><use href="#ico-leader"></use></svg> Leaderboard</button>
    </div>
  </div>
  <div id="s-browse" class="card">
    <div class="toolbar">
      <h2 style="display:flex;align-items:center;gap:8px"><svg class="icon"><use href="#ico-search-doc"></use></svg> Browse Projects</h2>
      <input id="sSearch" class="input right" placeholder="Search title or category‚Ä¶"/>
    </div>
    <div class="divider"></div>
    <table id="sTable"><thead>
      <tr><th>Title</th><th>Company</th><th>Category</th><th>Budget</th><th>Due</th><th>Status</th><th></th></tr>
    </thead><tbody></tbody></table>
  </div>
  <div id="s-my" class="card hide">
    <h2><svg class="icon"><use href="#ico-folder"></use></svg> My Applications</h2>
    <table id="sMy"><thead>
      <tr><th>Project</th><th>Company</th><th>Status</th><th>Action</th></tr>
    </thead><tbody></tbody></table>
  </div>
  <div id="s-chat" class="card hide">
    <h2><svg class="icon"><use href="#ico-msg-arrow"></use></svg> Chat</h2>
    <div class="chat" id="sChat"></div>
    <div class="toolbar" style="margin-top:10px">
      <input id="sMsg" class="input" placeholder="Type a message‚Ä¶"/>
      <button class="btn" id="sSend">Send</button>
    </div>
  </div>
  <div id="s-leader" class="card hide">
    <h2><svg class="icon"><use href="#ico-leader"></use></svg> Leaderboard</h2>
    <table id="sLeader"><thead><tr><th>#</th><th>Student</th><th>XP</th><th>Done</th></tr></thead><tbody></tbody></table>
  </div>
</section>
<!-- AUTH MODAL -->
<div class="modal" id="auth">
  <div class="sheet card">
    <div class="row" style="align-items:center;justify-content:space-between">
      <h2>Welcome to Learn&Earn</h2>
      <button class="btn ghost" id="closeAuth">Close</button>
    </div>
    <div class="divider"></div>
    <div class="row">
      <div class="col">
        <h3>Sign Up</h3>
        <input id="suUser" class="input" placeholder="Username" style="margin:8px 0">
        <input id="suEmail" class="input" placeholder="Email" style="margin:8px 0">
        <input id="suPass" type="password" class="input" placeholder="Password" style="margin:8px 0">
        <button class="btn" id="doSignup">Create Account</button>
      </div>
      <div class="col">
        <h3>Login</h3>
        <input id="liEmail" class="input" placeholder="Email" style="margin:8px 0">
        <input id="liPass" type="password" class="input" placeholder="Password" style="margin:8px 0">
        <!-- Forgot Password will be added by JS -->
        <button class="btn soft" id="doLogin">Login</button>
      </div>
    </div>
  </div>
</div>
<footer class="wrap center">
  <div class="divider"></div>
  <div>¬© Learn&Earn ‚Äî ‚ÄúConnect. Learn. Earn.‚Äù</div>
</footer>
<svg width="0" height="0" style="position:absolute">
  <defs><linearGradient id="g" x1="0" x2="1" y1="1" y2="0"><stop offset="0%" stop-color="var(--grad-a)"/><stop offset="100%" stop-color="var(--grad-b)"/></linearGradient></defs>
  <symbol id="ico-clip" viewBox="0 0 24 24"><path fill="url(#g)" d="M7 13.5 14.5 6a4.24 4.24 0 1 1 6 6L11 21.5a6.36 6.36 0 0 1-9-9L9.5 5.5"/></symbol>
  <symbol id="ico-submit" viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="7" ry="7" fill="none" stroke="url(#g)" stroke-width="2.2"/><text x="12" y="14.5" text-anchor="middle" font-size="6.4" font-family="Inter" fill="url(#g)" font-weight="800">SUBMIT</text></symbol>
  <symbol id="ico-msg-arrow" viewBox="0 0 24 24"><path fill="url(#g)" d="M3 4h18a2 2 0 0 1 2 2v8a5 5 0 0 1-5 5H11l-4.5 3v-3H5a4 4 0 0 1-4-4V6a2 2 0 0 1 2-2z"/><path fill="#fff" d="M10 12h5l-2.5-3 1-1 4 4-4 4-1-1 2.5-3H10z"/></symbol>
  <symbol id="ico-doc-plus" viewBox="0 0 24 24"><path fill="url(#g)" d="M7 2h7l5 5v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm7 6h5l-5-5v5Z"/><path fill="url(#g)" d="M12 11v-3h2v3h3v2h-3v3h-2v-3H9v-2h3Z"/></symbol>
  <symbol id="ico-search-doc" viewBox="0 0 24 24"><path fill="url(#g)" d="M7 2h7l5 5v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm7 6h5l-5-5v5Z"/><path fill="url(#g)" d="M9.5 11a3.5 3.5 0 1 0 2.83 5.6l2.27 2.27 1.4-1.4-2.27-2.27A3.5 3.5 0 0 0 9.5 11Z"/></symbol>
  <symbol id="ico-leader" viewBox="0 0 24 24"><path fill="url(#g)" d="M4 20h16v2H4v-2Zm2-6h3v6H6v-6Zm5-8h3v14h-3V6Zm5 4h3v10h-3V10Z"/><path fill="url(#g)" d="M12 3l2 3h-4l2-3z"/></symbol>
  <symbol id="ico-briefcase" viewBox="0 0 24 24"><path fill="url(#g)" d="M9 3h6a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V9a2 2 0 0 1 2-2h2V5a2 2 0 0 1 2-2Zm6 4V5H9v2h6Z"/></symbol>
  <symbol id="ico-cap" viewBox="0 0 24 24"><path fill="url(#g)" d="m12 3 10 5-10 5L2 8l10-5Zm7 8v5c0 2.8-3.6 5-7 5s-7-2.2-7-5v-5l7 3.5L19 11Z"/></symbol>
  <symbol id="ico-folder" viewBox="0 0 24 24"><path fill="url(#g)" d="M10 4h2l2 2h6a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6Z"/></symbol>
</svg>

<!-- ‚úÖ FIXED FIREBASE SDK - NO TRAILING SPACES -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA48QxlLR3ZWaoBca1Nd3fYW6cO4AkKnfU",
    authDomain: "learn-earn-6ee64.firebaseapp.com",
    projectId: "learn-earn-6ee64",
    storageBucket: "learn-earn-6ee64.firebasestorage.app",
    messagingSenderId: "1012222597953",
    appId: "1:1012222597953:web:9bc28baa9194aa5b529fc0"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const todayPlus = d => new Date(Date.now() + d * 86400000).toISOString().slice(0, 10);

  let currentUser = null;
  let currentChatProjectId = null;
  let chatUnsub = null;
  let leaderUnsub = null;

  function setAuthedUI(user) {
    $('#authBtns').classList.add('hide');
    $('#userMenu').classList.remove('hide');
    $('#avatar').textContent = (user.username?.[0] || 'U').toUpperCase();
    $('#roleBadge').textContent = user.role === 'company' ? 'Company' : 'Student';
  }
  function setLoggedOutUI() {
    $('#userMenu').classList.add('hide');
    $('#authBtns').classList.remove('hide');
  }
  function show(id) {
    ['home','role','company','student'].forEach(sec => {
      const el = $(`#${sec}`);
      if (!el) return;
      if (sec === id) {
        el.classList.remove('hide');
        requestAnimationFrame(() => el.classList.add('show'));
      } else {
        el.classList.remove('show');
        setTimeout(() => el.classList.add('hide'), 250);
      }
    });
    updateCounters();
  }

  async function updateCounters() {
    const [pSnap, uSnap] = await Promise.all([
      db.collection('projects').get(),
      db.collection('users').get()
    ]);
    const open = pSnap.docs.filter(d => d.data().status === 'Open').length;
    const students = uSnap.docs.filter(d => d.data().role === 'student').length;
    const companies = uSnap.docs.filter(d => d.data().role === 'company').length;
    $('#kOpen').textContent = open;
    $('#kStudents').textContent = students;
    $('#kCompanies').textContent = companies;
  }

  const modal = $('#auth');
  $('#getStarted').onclick = () => modal.classList.add('show');
  $('#loginOpen').onclick = () => modal.classList.add('show');
  $('#signupOpen').onclick = () => modal.classList.add('show');
  $('#closeAuth').onclick = () => modal.classList.remove('show');

  // üîê ADD FORGOT PASSWORD LINK
  const forgotLink = document.createElement('a');
  forgotLink.href = '#';
  forgotLink.id = 'forgotPassword';
  forgotLink.textContent = 'Forgot Password?';
  forgotLink.style.cssText = 'font-size:14px;color:var(--grad-a);text-decoration:none;margin-top:4px;display:block;';
  $('#liPass').after(forgotLink);

  $('#forgotPassword').onclick = (e) => {
    e.preventDefault();
    const email = $('#liEmail').value.trim();
    if (!email) return alert('Enter your email.');
    auth.sendPasswordResetEmail(email)
      .then(() => alert(`Password reset email sent to ${email}`))
      .catch(err => alert(err.message));
  };

  $('#doSignup').onclick = async () => {
    const email = $('#suEmail').value.trim();
    const pass = $('#suPass').value;
    const username = $('#suUser').value.trim();
    if (!email || !pass || !username) return alert('Fill all fields.');
    try {
      const cred = await auth.createUserWithEmailAndPassword(email, pass);
      await cred.user.sendEmailVerification();
      await db.collection('users').doc(cred.user.uid).set({ username, email, role: null, xp: 0, done: 0 });
      modal.classList.remove('show');
      alert('Account created! Please verify your email.');
    } catch (err) { alert(err.message); }
  };

  $('#doLogin').onclick = async () => {
    const email = $('#liEmail').value.trim();
    const pass = $('#liPass').value;
    try {
      await auth.signInWithEmailAndPassword(email, pass);
      modal.classList.remove('show');
    } catch (err) { alert(err.message); }
  };

  function promptEmailVerification() {
    if (!auth.currentUser.emailVerified) {
      if (confirm('Please verify your email. Resend verification?')) {
        auth.currentUser.sendEmailVerification()
          .then(() => alert('Verification email sent!'))
          .catch(err => alert(err.message));
      }
    }
  }

  auth.onAuthStateChanged(async (user) => {
    if (user) {
      const doc = await db.collection('users').doc(user.uid).get();
      if (doc.exists) {
        currentUser = { id: user.uid, ...doc.data() };
        if (!user.emailVerified) promptEmailVerification();
      } else {
        const username = user.email.split('@')[0];
        await db.collection('users').doc(user.uid).set({ username, email: user.email, role: null, xp: 0, done: 0 });
        currentUser = { id: user.uid, username, email: user.email, role: null, xp: 0, done: 0 };
      }
      setAuthedUI(currentUser);
      if (currentUser.role) routeByRole(currentUser.role);
      else show('role');
    } else {
      currentUser = null;
      setLoggedOutUI();
      show('home');
    }
  });

  $('#logout').onclick = () => auth.signOut();
  $('#goDash').onclick = () => {
    if (currentUser?.role) routeByRole(currentUser.role);
  };

  $('#chooseCompany').onclick = async () => {
    if (!currentUser) return modal.classList.add('show');
    await db.collection('users').doc(currentUser.id).update({ role: 'company' });
    currentUser.role = 'company';
    setAuthedUI(currentUser);
    routeByRole('company');
  };
  $('#chooseStudent').onclick = async () => {
    if (!currentUser) return modal.classList.add('show');
    await db.collection('users').doc(currentUser.id).update({ role: 'student' });
    currentUser.role = 'student';
    setAuthedUI(currentUser);
    routeByRole('student');
  };

  $('#publishBtn').onclick = async () => {
    const title = $('#pTitle').value.trim();
    const budget = +$('#pBudget').value;
    const due = $('#pDue').value || todayPlus(5);
    const cat = $('#pCat').value;
    const desc = $('#pDesc').value.trim();
    if (!title || !budget || !desc) return alert('Fill all fields.');
    await db.collection('projects').add({
      title, budget, due, cat, desc, status: 'Open',
      companyId: currentUser.id,
      applicants: []
    });
    $('#pTitle').value = $('#pBudget').value = $('#pDesc').value = '';
    alert('Project published!');
    updateCounters();
  };

  async function drawBrowse() {
    const [pSnap, uSnap] = await Promise.all([
      db.collection('projects').where('status', '!=', 'Done').get(),
      db.collection('users').get()
    ]);
    const userMap = {};
    uSnap.forEach(doc => userMap[doc.id] = doc.data().username || 'Company');
    const term = ($('#sSearch').value || '').toLowerCase();
    const tbody = $('#sTable tbody');
    tbody.innerHTML = '';
    pSnap.forEach(doc => {
      const p = { id: doc.id, ...doc.data() };
      if (![p.title, p.cat].join(' ').toLowerCase().includes(term)) return;
      const isApplied = p.applicants?.includes(currentUser.id);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.title}</td>
        <td>${userMap[p.companyId]}</td>
        <td>${p.cat}</td>
        <td>‚Çπ${p.budget}</td>
        <td>${p.due}</td>
        <td class="status ${p.status === 'Open' ? 'open' : 'progress'}">${p.status}</td>
        <td><button class="btn" ${isApplied ? 'disabled' : ''} onclick="apply('${p.id}')">${isApplied ? 'Applied' : 'Apply'}</button></td>`;
      tbody.appendChild(tr);
    });
  }
  $('#sSearch').oninput = drawBrowse;

  window.apply = async (pid) => {
    const ref = db.collection('projects').doc(pid);
    const p = (await ref.get()).data();
    if (!p.applicants.includes(currentUser.id)) {
      p.applicants.push(currentUser.id);
      p.status = 'In Progress';
      await ref.update(p);
      drawBrowse(); drawMyApps(); updateCounters();
    }
  };

  async function drawMyApps() {
    const [pSnap, uSnap] = await Promise.all([
      db.collection('projects').where('applicants', 'array-contains', currentUser.id).get(),
      db.collection('users').get()
    ]);
    const userMap = {};
    uSnap.forEach(doc => userMap[doc.id] = doc.data().username || 'Company');
    const tbody = $('#sMy tbody');
    tbody.innerHTML = '';
    pSnap.forEach(doc => {
      const p = { id: doc.id, ...doc.data() };
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.title}</td>
        <td>${userMap[p.companyId]}</td>
        <td class="status ${p.status === 'Done' ? 'done' : 'progress'}">${p.status}</td>
        <td>
          <button class="btn soft" onclick="openStudentChat('${p.id}')">Chat</button>
          ${p.status !== 'Done' ? `<button class="btn" onclick="submitProject('${p.id}')">Submit</button>` : '<span class="muted">Submitted</span>'}
        </td>`;
      tbody.appendChild(tr);
    });
  }

  window.submitProject = async (projectId) => {
    const megaLink = prompt('Enter your MEGA file link:');
    if (!megaLink?.trim()) return alert('Please enter a valid MEGA link.');
    await db.collection('projects').doc(projectId).update({
      megaLink: megaLink.trim(),
      status: 'Done'
    });
    await db.collection('users').doc(currentUser.id).update({
      xp: firebase.firestore.FieldValue.increment(100),
      done: firebase.firestore.FieldValue.increment(1)
    });
    alert('Project submitted!');
    drawMyApps();
    updateCounters();
  };

  function setupLiveChat(projectId) {
    if (chatUnsub) chatUnsub();
    currentChatProjectId = projectId;
    const box = $('#cChat').offsetParent ? $('#cChat') : $('#sChat');
    chatUnsub = db.collection(`projects/${projectId}/messages`)
      .orderBy('timestamp')
      .onSnapshot(snap => {
        box.innerHTML = '';
        snap.forEach(doc => {
          const msg = doc.data();
          const div = document.createElement('div');
          const mine = msg.senderId === currentUser.id;
          div.className = 'msg ' + (mine ? 'me' : 'them');
          div.innerHTML = `<b>${msg.senderName}:</b> ${msg.text}`;
          box.appendChild(div);
        });
        box.scrollTop = box.scrollHeight;
      });
  }

  async function sendMessage() {
    if (!currentChatProjectId) return;
    const text = ($('#cMsg')?.value || $('#sMsg')?.value || '').trim();
    if (!text) return;
    await db.collection(`projects/${currentChatProjectId}/messages`).add({
      senderId: currentUser.id,
      senderName: currentUser.username,
      text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    if ($('#cMsg')) $('#cMsg').value = '';
    if ($('#sMsg')) $('#sMsg').value = '';
  }

  $('#cSend')?.addEventListener('click', sendMessage);
  $('#sSend')?.addEventListener('click', sendMessage);

  window.openStudentChat = (projectId) => {
    $$('#student .tab')[2].click();
    setupLiveChat(projectId);
  };

  async function drawCompanyProjects() {
    const term = ($('#cSearch').value || '').toLowerCase();
    const pSnap = await db.collection('projects').where('companyId', '==', currentUser.id).get();
    const tbody = $('#cTable tbody');
    tbody.innerHTML = '';
    pSnap.forEach(doc => {
      const p = { id: doc.id, ...doc.data() };
      if (![p.title, p.cat].join(' ').toLowerCase().includes(term)) return;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.title}</td>
        <td>${p.cat}</td>
        <td>‚Çπ${p.budget}</td>
        <td>${p.due}</td>
        <td class="status ${p.status === 'Open' ? 'open' : p.status === 'In Progress' ? 'progress' : 'done'}">${p.status}</td>
        <td>${p.applicants?.length || 0}</td>
        <td>
          <button class="btn soft" onclick="openCompanyChat('${p.id}')">Chat</button>
          ${p.megaLink ? `<a href="${p.megaLink}" target="_blank" class="btn">View File</a>` : ''}
        </td>`;
      tbody.appendChild(tr);
    });
  }
  $('#cSearch').oninput = drawCompanyProjects;

  window.openCompanyChat = (projectId) => {
    $$('#company .tab')[2].click();
    setupLiveChat(projectId);
  };

  function setupLiveLeaderboard(tableId) {
    if (leaderUnsub) leaderUnsub();
    const tbody = $(`#${tableId} tbody`);
    leaderUnsub = db.collection('users')
      .where('role', '==', 'student')
      .orderBy('xp', 'desc')
      .limit(10)
      .onSnapshot(snap => {
        tbody.innerHTML = '';
        let rank = 1;
        snap.forEach(doc => {
          const u = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${rank++}</td><td>${u.username}</td><td>${u.xp || 0}</td><td>${u.done || 0}</td>`;
          tbody.appendChild(tr);
        });
      });
  }

  $$('#company .tab').forEach(btn => {
    btn.onclick = () => {
      const tabId = btn.dataset.ctab;
      $$('#company .tab').forEach(b => b.classList.toggle('active', b === btn));
      ['c-post','c-projects','c-chat','c-leader'].forEach(id => {
        $(`#${id}`)?.classList.toggle('hide', id !== tabId);
      });
      if (tabId === 'c-projects') drawCompanyProjects();
      if (tabId === 'c-leader') setupLiveLeaderboard('cLeader');
    };
  });

  $$('#student .tab').forEach(btn => {
    btn.onclick = () => {
      const tabId = btn.dataset.stab;
      $$('#student .tab').forEach(b => b.classList.toggle('active', b === btn));
      ['s-browse','s-my','s-chat','s-leader'].forEach(id => {
        $(`#${id}`)?.classList.toggle('hide', id !== tabId);
      });
      if (tabId === 's-browse') drawBrowse();
      if (tabId === 's-my') drawMyApps();
      if (tabId === 's-leader') setupLiveLeaderboard('sLeader');
    };
  });

  function routeByRole(role) {
    if (role === 'company') {
      show('company');
      $$('#company .tab')[0].click();
      $('#pDue').value = todayPlus(5);
    } else {
      show('student');
      $$('#student .tab')[0].click();
    }
  }
</script>
</body>
</html>

